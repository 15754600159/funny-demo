$(function() {
	//根据身份证号 加载数据
	getData()
})
//根据身份证号 加载数据
function getData() {
	var sfz = location.href.split('?')[1]

	$.ajax({
		type: "get",
		url: bjhchost+ "/task/info/one/" + sfz,
		async: true,
		success: function(data) {
			var data1 = data.msg.details
			var data2 = data.msg.relations
			console.log(data)
			
			var htmlDetail = getHtmlDetail(data1);
			$('.content').append(
				'<div class="own-info-box">' +
				htmlDetail +
				'<br style="clear:both;">' +
			'</div>' +
			'<div class="immediate-family-list">' +
				'<h3>直系亲属信息</h3>' +
			'</div>' 
			);
			
			$.each(data2, function(k, v) {
				
				var familyDetail = getHtmlDetail(v);
				$('.immediate-family-list').append(
					'<div class="family-info-box">' +
					familyDetail + 
					// <!-- 本人标签信息end -->
					'</div>'
				)
			});
		}
	});
}

function getHtmlDetail(data1){
	
	var sex = ''
		
	if(data1.sex == 1 || data1.sex == '男') {
		sex = '男'
	} else if(data1.sex == 2 || data1.sex == '女') {
		sex = '女'
	} else {
		sex = ''
	}
	var txt = data1.tagDetail
	var txts = '';
	
	var tag = data1.tag==null?'' : data1.tag;
	var tagArr = tag.split(",");
	var tagDangerHtml = '';
	var tagWarningHtml = '';
	var tagInfoHtml = '';
	if(tagArr.length > 0){
		var i = 0;
		for(i=0;i<tagArr.length;i++){
			tagDangerHtml += '<span class="label label-danger">'+ tagArr[i] +'</span>';
			tagWarningHtml += '<span class="label label-warning">'+ tagArr[i] +'</span>';
			tagInfoHtml += '<span class="label label-info">'+ tagArr[i] +'</span>';
		}
	}
	
    var zyHtml = '';
	var zyStr = (data1.zy2==null?'' : data1.zy2)+"";
	console.log(zyStr);
	if(zyStr){
		if(isJSON(zyStr)){
			var zyArray = JSON.parse(zyStr);
			var i;
			for(i = 0; i<zyArray.length; i++){
				var zyinfo = zyArray[i].fields;
				var infoStr = "";
				$.each(tagInfos,function(index,item){
					infoStr+= index + ":" + item + " ";
				});
				zyHtml += '<span class="label label-default">'+zyArray[i].tag+ ' ' +infoStr + '</span>'
			}
		}else{
			zyHtml = '<span class="label label-default">'+zyStr+'</span>'
		}
	}else{
		zyHtml = '<span class="label label-default">无数据</span>'
	}
	
	var strHtml = '<div class="img-box"><img src="http://10.100.9.60:9082/dzda/rygk/RequestPhoto.jsp?sfzh=' + data1.idCard + '"/></div>' +
	'<div class="detail-box">' +
	'<div class="person-info">' +
		'<div class="person-info-row row">' +
			'<div class="col-md-4">姓名：<span class="person-name">' + (data1.name == null ? '' : data1.name) + '</span></div>' +
			'<div class="col-md-8">身份证号：<span class="person-sfzh">' + (data1.idCard == undefined ? '' : data1.idCard) + '</span></div>' +
		'</div>' +
		'<div class="person-info-row row">' +
			'<div class="col-md-4">性别：<span class="person-sex">' + sex + '</span></div>' +
			'<div class="col-md-8">户籍地：<span class="person-domicile">' + (data.birthplace == null ? '' : data.birthplace) + '</span></div>' +
		'</div>' +
		'<div class="person-info-row row">' +
			'<div class="col-md-4">民族：<span class="person-nation">' + (dataJx(data1.nation,mzMap)) + '</span></div>' +
			'<div class="col-md-8">现住地：<span class="person-residence">' + (data.xzz == null ? '' : data.xzz) + '</span></div>' +
		'</div>' +
		'<div class="person-info-row row">' +
			'<div class="col-md-12">职业：<span class="person-occupation">' + (data.zy1 == null ? '' : data.zy1) + '</span></div>' +
		'</div>' +
	'</div>' +
	'<div class="occupation">' +
		'职业：' +zyHtml +
		'</span>' +
	'</div>' +
	'<div class="person-attribute">' +
		'<div class="social-attr">' +
			'基础社会属性：<span class="label label-default">常住人口</span>' +
		'</div>' +
		'<div class="security-person">' +
			'社会保障人员：' +
			'<span class="label label-default">残疾人员</span>' +
			'<span class="label label-default">低保人员</span>' +
			'<span class="label label-default">医保人员</span>' +
		'</div>' +
	'</div>' +
	'</div>' +
	'<div class="tags row">' +
		'<div class="col-md-2 col-md-offset-1">红色标签：</div>' +
		'<div class="col-md-9 labels">' + tagDangerHtml +
		'</div>' +
		'<div class="col-md-2 col-md-offset-1">黄色标签：</div>' +
		'<div class="col-md-9 labels">' + tagWarningHtml +
		'</div>' +
		'<div class="col-md-2 col-md-offset-1">蓝色标签：</div>' +
		'<div class="col-md-9 labels">' + tagInfoHtml +
		'</div>' +
	'</div>';
	
	return strHtml;
	
}

function isJSON(str) {
	try {
		JSON.parse(str);
    } catch (e) {
        return false;
    }
    return true;
}
/*//任务详情数据
function TaskSfz() {
	var jobid = location.href.split('?')[2]
	var idcard = location.href.split('?')[1]
	if(jobid == undefined) {
		return false;
	}
	
	$.ajax({
		type:"get",
		url:"http://10.101.139.21:8777/bjhc/card/"+jobid+'/'+idcard,
		async:true,
		success: function (data) {
			console.log(data)
		}
	});
}
*/









