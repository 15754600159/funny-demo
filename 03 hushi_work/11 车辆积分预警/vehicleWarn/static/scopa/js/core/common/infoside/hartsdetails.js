define("scopa/core/common/infoside/hartsdetails",[],function(a,b,c){({merge:mining.baseurl.core+"/query/merge",expandHartsEdge:mining.baseurl.core+"/query/expandHartsEdge"}),c.exports=function(){var a=function(a,c,d,e){ruleList=mining.mappingutils.getHartEvents(a),mining.utils.getHartsData({data:a,success:function(f){seajs.log(f),b(a,c,d,e,f.hits,f.all)}})},b=function(a,b,c,d,e,f){if($(" main",b).remove(),!mining.utils.isEmpty(f)){var g=function(a){var b="",c=['<div class="property hide">'];return $.each(mining.mappingutils.getProperties(a,"primary"),function(a,b){c.push('<span style="display: block" >'+b.name+":"+b.value+"</span>")}),c.push("</div>"),$.each(mining.mappingutils.getShowlabel(a,"bigger"),function(a,c){b+='<span style="display: block" class="txt" >'+c.name+":"+c.value+"</span>"}),b+c.join("")};0==b.siblings(".eventtab").length&&b.before("<ul class='eventtab'><li class='active' ismerge='true'>命中事件</li><li ismerge='false' >全部事件</li></ul>"),$("table",b).after("<main role='main'><ol class='timelineinfo'></ol></main>");var h=function(a){a="true"==a?!0:!1;var h=[],i=[];if($.each(f.events,function(a,b){i=i.concat(b),i.sort(function(a,b){return parseInt(b.time)-parseInt(a.time)})}),$.each(e.pairs,function(a,b){$.each(i,function(a,c){mining.utils.isEmpty(c)&&i.remove(c);try{if(b.from==c.id)return c.harts=!0,h.push(c),$.each(i,function(a,d){return b.to==d.id?(h.push(d),c.toId=d.id,!0):void 0}),!0}catch(d){seajs.log(c)}})}),a&&(i=h),i.sort(function(a,b){return parseInt(b.time)-parseInt(a.time)}),0==i.length)return $("main",b).html("没有数据"),void 0;$("main",b).html('<ol class="timelineinfo"></ol>');var j=moment(parseInt(i[0].time)).format("YYYY-MM-DD");$.each(i,function(a,e){if(!mining.utils.isEmpty(e)&&!mining.utils.isEmpty(e.key)){var f=moment(parseInt(e.time)).format("YYYY-MM-DD"),h=(moment(parseInt(e.time)).format("YYYY-MM-DD HH:mm:ss"),"");-1!=c.indexOf(e.key)?h="l":-1!=d.indexOf(e.key)&&(h="r"),mining.utils.isEmpty(h)||($(".timelineinfo:first",b).append([(j!=f?'<li class="dateinfo  timelineinfo-r" >'+j+"</li>":"")+'<li eventid="'+e.id+'" toid="'+e.toId+'" class="timelineinfo-'+(e.harts?h+" harts":h)+'">',g(e,name),"<button></button>","</li>"+(a==i.length-1?'<li class="dateinfo  timelineinfo-r" >'+f+"</li>":"")].join("")),j=f)}}),$.each($(".harts",b),function(a,b){var c=$(b).offset().top,d=$(".timelineinfo li[eventid="+$(b).attr("toid")+"]").offset().top;$(b).css("top",d-c+"px")}),$(".timelineinfo .property",b).mCustomScrollbar({theme:"minimal"})};b.parent().off("click",".eventtab li").on("click",".eventtab li",function(){var a=$(this).attr("ismerge");$(this).addClass("active").siblings().removeClass("active"),h(a),"false"==a&&mining.utils.serverLog(53)}),b.off("mouseover mouseout",".timelineinfo li").on("mouseover",".timelineinfo li",function(){$(this).css("z-index",111).find(".property").removeClass("hide")}).on("mouseout",".timelineinfo li",function(){$(this).css("z-index",100).find(".property").addClass("hide")}),$(" .eventtab li:first",b.parent()).click()}};return{init:a}}});
