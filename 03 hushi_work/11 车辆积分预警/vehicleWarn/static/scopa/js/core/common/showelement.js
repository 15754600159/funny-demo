define("scopa/core/common/showelement",[],function(){var a=function(a,b,e){if(!mining.utils.isEmpty(a)&&!mining.utils.isEmpty(b)&&(a.v||a.e||"2"==e)){switch(b){case"graph":var f=c(a);if($(".page-graph").hasClass("active")&&e){var g=dragon.pan();$.each(f.nodes,function(a,b){b.position.x=e.pageX-g.x,b.position.y=e.pageY-50+150*a-g.y})}mining.utils.localStorage(mining.localname.graphSnapshot,{graph:{elements:f},action:"import"});break;case"map":var h=mining.utils.localStorage(mining.localname.mapSnapshot)||[];h.filelist||(h.filelist=[]),$.each(d(a),function(a,b){h.pushOnly(b)}),mining.utils.localStorage(mining.localname.mapSnapshot,h);break;case"file":var i=[],j=[],k=1;"2"==e?(j=a,k=e):(i=d(a),$.each(i,function(a,b){b.etype||(b.etype=mining.mappingutils.getType(b)),("doc"==b.label||"media"==b.label&&"doc"==b.type)&&(k=3),j.push(b)})),mining.utils.updateFileData("add",{dataArr:j,tabType:k})}var l=$.hash();if(mining.utils.isEmpty(l)&&window.top)return window.top.mining.utils.hashChange(b),void 0;-1==$.hash().indexOf(b)?mining.utils.hashChange(b):$(".subpage.active").data("module").snapshot()}},b=function(a,b){switch(b=b||"graph"){case"graph":c();break;case"map":getMapElements();break;case"file":getFileElements();break;default:c()}},c=function(a){var b={nodes:[],edges:[]};return mining.utils.isEmpty(a)?b:(a.v&&$.each(a.v,function(a,c){"熊大"==c.PERSON_xm&&(c.photoUrl=staticUrl+"/scopa/images/core/xd.png"),c.etype=c.etype?c.etype:"entity";var d=mining.mappingutils.getGraphIcon(c);"person"!=c.label||"non_cri_person"!=c.type&&"non_eventful_person"!=c.type||(d=d.replace("/graphicon/","/graphicon/special/")),b.nodes.push({data:{id:String(c.gid),name:f(c),showbigger:f(c,"show_bigger"),data:c,etype:c.etype,image:d},position:{x:100,y:100+100*a},classes:e(c),selected:!0})}),a.e&&$.each(a.e,function(a,c){c.etype=c.etype?c.etype:"relation",b.edges.push({data:{id:String(c.gid),source:String(c.from),target:String(c.to),data:c,etype:c.etype,event:mining.utils.isEmpty(c.showlabel)?f(c):c.showlabel},classes:e(c),selected:!0})}),b)},d=function(a){var b={},c=[];return mining.utils.isEmpty(a)?c:(a.v&&$.each(a.v,function(a,d){d.etype=d.etype?d.etype:"entity",c.push(d),b[d.gid]=d}),a.e&&$.each(a.e,function(a,d){d.etype=d.etype?d.etype:"relation",c.push($.extend(d,{source:b[d.from],target:b[d.to]}))}),c)},e=function(a){var b=[];return b.push(a.etype,a.label,mining.mappingutils.getName(a)),a.class&&b.push(a.class),"person"==a.label&&"女"==a.PERSON_xb&&b.push("women"),"custom"==a.specificType&&b.push("new"),b.join(" ")},f=function(a,b){var c=mining.mappingutils.getShowlabel(a,b),d=[];return $.each(c,function(a,b){d.push(b.value)}),d.join("\n")};return{show:a,get:b}});
