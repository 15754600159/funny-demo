define("scopa/core/common/infoside/timereel",["jqueryui"],function(a,b,c){var d={graph:null,eventModule:null,container:null,selection:null,eventarr:null};c.exports=function(){var b,c,e,f=null,g=null,h=null,i=null,j=!1,k=!1,l="#224a84",m=function(a){a=$.extend({},d,a),f=a.graph,g=a.eventModule,b=a.container,c=$(".info-timereel",b),i=a.selection||[],h=a.eventarr||[],mining.utils.isEmpty(f)||b.size()<1||c.size()<1||($(".reelselected",c).height(mining.browser.h-600-70).mCustomScrollbar({theme:"minimal"}),t(),u(),v())},n=1,o=0,p=10,q=6.5,r=function(){o=360*-n/24,$(".timereel",c).transform("rotateY("+o+"deg)"),n++},s=function(a){clearInterval(e),"stop"==a?$(".timereel",c).transform("transform 0 linear","transition"):($(".timereel",c).transform("transform 0.5s linear","transition"),r(),e=setInterval(r,500))},t=function(){var d=moment.weekdays();d.push(d.shift());for(var e=cols="",h='<div class="th {axis}">{time}</div>',i=0;7>i;i++)e+='<div class="td" week="'+i+'" hour="{hour}"></div>';e='<div class="row">'+e+"</div>";for(var i=0;24>i;i++)_axis=h.replace("{time}",i),cols+='<div class="col">'+_axis.replace("{axis}","thead")+e.replaceAll("{hour}",i)+_axis.replace("{axis}","tfoot")+"</div>";$(".timereel",c).html(cols);for(var m="",i=1;10>=i;i++)m+='<span style="background-color:'+mining.utils.getRGB(l,i/10)+";border-color:"+mining.utils.getRGB("#147a8d",i/10)+'"><i>'+10*i+"%</i></span>";$(".legend-color",c).html(m);var n=360,r=n/24;transZ=p/Math.tan(r/2/(n/2)*Math.PI),$(".timereel .col",c).each(function(a){$(this).transform("rotateY("+a*r+"deg) translateZ("+transZ+"px)")}),$(".timereelbox",c).css("perspective","1200px");var t=!1,u=0,v=0;a("jqueryui"),$(".timereelbox .col",c).draggable({helper:"clone",opacity:.01,start:function(a,b){k||(t=!0,v=b.position.left)},drag:function(a,b){if(!k){var d=b.position.left-v;Math.abs(d)>100||(u=o+180*d/100,$(".timereel",c).transform("rotateY("+u+"deg)"))}},stop:function(){k||(o=u,u=0,$(".timereel",c).transform("rotateY("+o+"deg)"),t=!1)}}),$(".timereelbox .mask,.reelselected",c).on("mouseenter",function(){k||t||($(".timereelbox .reel-close",c).fadeIn(),s())}),$(".timereelbox .reel-close",c).on("mouseenter",function(){$(".timereelbox .reel-close",c).fadeOut()}),$(".timereelbox .col",c).on("mouseenter",function(){s("stop")});var w=function(){j||(j=!0,k=!0,s("stop"),$(".timereelbox .mask",c).animate({opacity:0},150),$(".timereelbox .reel-close,.timereelbox .reel-top",c).fadeOut("150"),setTimeout(function(){$(".timereel",c).transform("rotateY(0deg)"),$(".timereelbox",c).addClass("expand");var a=115,b=a/24;transZ=q/Math.tan(b/2/(a/2)*Math.PI),$(".timereel .col",c).each(function(c){$(this).transform("rotateY("+(c*b-a/2)+"deg) translateZ("+(transZ+120)+"px)")}),$(".timereelbox",c).css("perspective","1400px"),$(".legend-weekday",c).animate({left:10},500)},100),setTimeout(function(){setTimeout(function(){$(".timereelbox .row",c).css("background","none")},100),$(".timereelbox .mask",c).css({opacity:"0","background-position":"11px 58px"}).animate({opacity:1},{duration:1e3,complete:function(){j=!1}})},450),-1!=$.hash().indexOf("graph")?mining.utils.serverLog(55):$(".page-map .breadnav-map").hasClass("active")&&mining.utils.serverLog(75))},x=function(){j||(j=!0,$(".timereelbox .mask",c).animate({opacity:0},{duration:200,complete:function(){$(this).css({"background-position":" -300px -300px"})}}),setTimeout(function(){$(".timereelbox .row",c).removeAttr("style")},150),setTimeout(function(){$(".timereel",c).transform("rotateY(0deg)");var a=360,b=a/24;transZ=p/Math.tan(b/2/(a/2)*Math.PI),$(".timereel .col",c).each(function(a){$(this).transform("rotateY("+a*b+"deg) translateZ("+transZ+"px)")}),$(".timereelbox",c).css("perspective","1200px"),$(".legend-weekday",c).animate({left:90},500),$(".timereelbox",c).removeClass("expand"),setTimeout(function(){$(".timereelbox .reel-close,.timereelbox .reel-top",c).fadeIn("150"),$(".timereelbox .mask",c).animate({opacity:1},{duration:150,complete:function(){j=!1,k=!1}})},400),s()},300))};if($(".timereelbox .mask,.timereelbox .reel-top",c).off("click").on("click",function(){k?x():w()}),$(".td",c).off("click").on("click",function(){var a,b=$(this).data("weight"),d=b.ids,e=b.ids.join(","),h=[];b.ids.length<1||(window.scopa_infosideaction=!0,window.scopa_infosideaction_timereel=!0,f.getOverlays?(h=[],a=[],$.each(f.elements(),function(a,c){c.unselect(),$.each(c.data("data"),function(a,d){!d.gid&&d.id&&(d.gid=d.id),-1!=b.ids.indexOf("#"+d.gid)&&(c.select(),h.push(d))})})):(f.$(e).length>0&&($(".eventlistdlg .eventlist tr").removeClass("active"),f.$(":selected").difference(e).unselect(),f.$(e).select(),$.each(f.$(e),function(a,b){h.push(b.data().data)})),$(".eventlistdlg .eventlist tr").removeClass("active"),$.each(d,function(a,b){var c=b.replace("#",""),d=g.getdata(c);$('.eventlistdlg .eventlist tr[gid="'+c+'"]').addClass("active"),mining.utils.isEmpty(d)||h.push(d)}),$(".eventlistdlg").each(function(){var a=$(this).find(".eventlist");a.mCustomScrollbar("scrollTo",$("tr.active:first",a))})),$(".reelitems",c).empty(),$.each(h,function(a,b){var d=b,e=mining.mappingutils.getTitle(d);$(".reelitems",c).append(['<div class="item" gid="'+(d.gid||d.id)+'">','<div class="num">'+(a+1)+"</div>",'<div class="icon"><span class="itemicon" style="background-image:url('+mining.mappingutils.getGraphIcon(d)+')"></span></div>','<div class="name ellipsis" title="'+e+'">'+e+"</div>","</div>"].join(""))}),window.scopa_infosideaction=!1,-1!=$.hash().indexOf("graph")?mining.utils.serverLog(54):$(".page-map .breadnav-map").hasClass("active")&&mining.utils.serverLog(74))}),c.off("click",".reelitems .item").on("click",".reelitems .item",function(){var a=$(this).attr("gid");try{if(f.getOverlays)$.each(f.elements(),function(b,c){c.unselect(),$.each(c.data("data"),function(b,d){return d.gid==a||d.id==a?(c.select(),!1):void 0})});else if($('.eventlist tr[gid="'+a+'"]').size()>0){var c;$(".list-unstyled.list-inline.modeltype li:first").hasClass("active")&&window.graphInfosideModule?c=window.graphInfosideModule:-1!=$.hash().indexOf("graph")&&window.mapInfosideModule&&(c=window.mapInfosideModule),window.scopa_infosideaction_timereel_click=!0,c&&c.show({graph:f,eventModule:g,container:b})}else{var d=f.$("#"+a);f.elements().not(d).unselect(),d.select(),window.graphInfosideModule&&(window.infosideModuleParam=d.data().id,window.graphInfosideModule.show({graph:f,eventModule:g,container:b}))}}catch(e){}}),window.infosideModuleParam=null,!j){j=!0,$(".timereelbox .mask",c).css({opacity:0,"background-position":" -300px -300px"}),$(".timereelbox .row",c).removeAttr("style"),$(".timereel",c).transform("rotateY(0deg)");var n=360,r=n/24;transZ=p/Math.tan(r/2/(n/2)*Math.PI),$(".timereel .col",c).each(function(a){$(this).transform("rotateY("+a*r+"deg) translateZ("+transZ+"px)")}),$(".timereelbox",c).css("perspective","1200px"),$(".legend-weekday",c).animate({left:90},500),$(".timereelbox",c).removeClass("expand"),$(".timereelbox .reel-close,.timereelbox .reel-top",c).show(),$(".timereelbox .mask",c).animate({opacity:1},{duration:1,complete:function(){j=!1,k=!1}}),s()}},u=function(){},v=function(a){$(".reelitems",c).empty(),s(a),$(".td",c).each(function(){$(this).css("background-color","rgba(144,172,206,0)").data("weight",{ids:[],title:{},value:0})});var b,d=[];$(".selectstate [parent=true]",c).hasClass("checked"),f.getOverlays?$.each(i,function(a,b){var c=b.data("data");$.each(c,function(a,b){d.push(b)})}):$.each(i.filter("edge.relation:selected,node:selected"),function(a,b){var c=b.data().data;d.push(c)}),d=g.getdata().concat(d),b=d.length,$.each(d,function(a,d){var e=d,f=(e.etype,mining.mappingutils.getTypeName(e)),g=mining.mappingutils.getTimeList(e);mining.utils.isEmpty(g)||$.each(g,function(a,d){d.name&&(f=d.name),$.each(d.time,function(a,d){var g=moment(parseInt(d)),h=parseInt(g.format("e")),i=parseInt(g.format("HH")),j=$("[week="+h+"][hour="+i+"]",c),k=j.data("weight"),m=[];k.ids.pushOnly("#"+(e.gid||e.id)),k.value++,k.title[f]?k.title[f]++:k.title[f]=1,$.each(k.title,function(a,b){m.push(a+"ï¼š"+b)}),j.css("background-color",mining.utils.getRGB(l,10*k.value/b)).data("weight",k).attr("title",m.join("\n"))})})})};return{init:m}}});
