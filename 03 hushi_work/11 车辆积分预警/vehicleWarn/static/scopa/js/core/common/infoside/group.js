define("scopa/core/common/infoside/group",[],function(a,b,c){var d={graph:null,container:null};c.exports=function(){var a,b,c,e,f=null,g=g,h=null,i=null,j=null,k=function(j){j=$.extend({},d,j),f=j.graph,g=j.eventModule,a=j.container,b=$(".info-group",a),h=j.selection||[],i=j.eventarr||[],c=j.details,e=j,mining.utils.isEmpty(f)||a.size()<1||b.size()<1||($(".infolistcontent",b).mCustomScrollbar({theme:"minimal"}),l(),m())},l=function(){b.off("click",".groupitem[label]").on("click",".groupitem[label]",function(){$(this).toggleClass("active"),scopa_infosideaction=!0;var a={select:[],unselect:[]};if($(".groupitem[label]",b).each(function(){var b=$(this),c="."+b.attr("label");try{if(-1!=c.indexOf("harts")){var d=c.split("_")[1],e=[];$.each(h.filter(".harts.relation"),function(a,b){mining.mappingutils.setRuleIds(b);var c=b.data().data.rule_ids;mining.utils.isEmpty(c)||-1==c.split(";").indexOf(d)||e.push("#"+b.id())}),c=e.join(",")}}catch(f){}mining.utils.isEmpty(c)||(b.hasClass("active")?a.select.pushOnly(c):a.unselect.pushOnly(c))}),a.unselect.length>0)try{h.filter(a.unselect.join(",")).unselect(),$.each(a.unselect,function(a,b){$('.eventlistdlg .eventlist tr[objname="'+b.replace(".","").replace("#","")+'"]').removeClass("active")})}catch(d){$.each(h,function(b,c){$.each(a.unselect,function(a,b){c.hasClass(b.replace(".",""))&&c.unselect(),$('.eventlistdlg .eventlist tr[objname="'+b.replace(".","").replace("#","")+'"]').removeClass("active")})})}if(a.select.length>0)try{h.filter(a.select.join(",")).select(),$.each(a.select,function(a,b){$('.eventlistdlg .eventlist tr[objname="'+b.replace(".","").replace("#","")+'"]').addClass("active")})}catch(d){$.each(h,function(b,c){$.each(a.select,function(a,b){c.hasClass(b.replace(".",""))&&c.select(),$('.eventlistdlg .eventlist tr[objname="'+b.replace(".","").replace("#","")+'"]').addClass("active")})})}if(a.select.length<1&&a.unselect.length<1)try{h.unselect(),j=h}catch(d){$.each(h,function(a,b){b.unselect()}),j=mining.utils.clone(h)}else try{j=h.filter(":selected")}catch(d){j=[],$.each(h,function(a,b){b.selected&&j.push(b)})}n(),c.init(e),-1!=$.hash().indexOf("graph")?mining.utils.serverLog(50,$(this).find(".name").attr("title")):$(".page-map .breadnav-map").hasClass("active")&&mining.utils.serverLog(70,$(this).find(".name").attr("title"))}),b.off("click",".groupitem[property]").on("click",".groupitem[property]",function(){var a={select:[],unselect:[]};$(this).toggleClass("active"),scopa_infosideaction=!0,$(".groupitem[property]",b).each(function(){var b=$(this),c=$(this).data("data");b.hasClass("active")?a.select=a.select.concat(c):a.unselect=a.unselect.concat(c)});var d=[];if($.each(a.unselect,function(b,c){-1==a.select.indexOf(c)&&d.push(c)}),d.length>0)try{j.filter(d.join(",")).unselect()}catch(f){$.each(j,function(a,b){$.each(d,function(a,c){b.data().data.gid==c.replace("#","")&&b.unselect()})})}if(a.select.length>0)try{j.filter(a.select.join(",")).select()}catch(f){$.each(j,function(b,c){$.each(a.select,function(a,b){c.data().data.gid==b.replace("#","")&&c.select()})})}if(a.select.length<1&&d.length<1)try{j.unselect()}catch(f){$.each(j,function(a,b){b.unselect()})}c.init(e),-1!=$.hash().indexOf("graph")?mining.utils.serverLog(50,$(this).find(".name").attr("title")):$(".page-map .breadnav-map").hasClass("active")&&mining.utils.serverLog(70,$(this).find(".name").attr("title"))})},m=function(){var a=mining.mappingutils.getTypeList(),c={entity:[],relation:[],event:[]},d="";if($(".grouplist",b).empty(),!(mining.utils.isEmpty(h)&&i.length<1)){g&&(d=g.getdata(":selected").length>0?":selected":"",mining.utils.isEmpty(i)&&(i=g.getdata(d))),$.each(a,function(a,b){var e=mining.mappingutils.getType(a),j=m=0;if(f.getOverlays)$.each(h,function(b,c){var d=c.data("data");d&&$.each(d,function(b,c){mining.mappingutils.getType(c)==e&&mining.mappingutils.getName(c)==a&&j++,mining.mappingutils.getType(c)==e&&m++})});else{var k="."+a+"."+e;if(j=h.filter(k).length,m=h.filter("."+e).length,$.each(f.$(".harts.relation"),function(a,b){m-=1;var c=mining.mappingutils.getTimeList(b.data().data);$.each(c,function(a,b){m+=b.time.length})}),"event"==e&&g)j=g.getdata(a,d).length,m=i.length;else if("harts"==a){var l={},m=h.filter("."+e).not(".harts.relation").length;return $.each(h.filter(k),function(a,b){var c=mining.mappingutils.getTimeList(b.data().data);$.each(c,function(a,b){l[b.label]||(l[b.label]={count:0,label:b.label,name:b.name}),l[b.label].count+=b.time.length,m+=b.time.length})}),$.each(l,function(a,b){c[e].push({labelname:b.label,name:b.name,count:b.count,total:m})}),void 0}}1>j||c[e].push({labelname:a,name:b,count:j,total:m})});var e={};$.each(c,function(a,b){b.length<1||(b.sort(function(a,b){return a.count<b.count?1:-1}),$.each(b,function(b,c){var d=(150*(c.count/c.total)).toFixed(2),f=c.name,g=parseFloat((100*d/150).toFixed(2))+'%"',h=' title="'+f+"："+g;e[a]||(e[a]=[]),e[a].push(['<div class="groupitem" label="'+c.labelname+'"'+h+">",'<div class="name" title="'+f+'">'+f+"</div>",'<div class="count">'+c.count+"</div>",'<div class="percentbar" style="width:'+d+'px;"></div>',"</div>"].join(""))}))}),$.each(e,function(a,c){$(".group-"+a+" .grouplist",b).append(c.join(""))}),o(),n()}},n=function(){var a={};$.each($(".groupitem.active[label]",b),function(){var b=$(this).attr("label"),c=mining.mappingutils.getGroupBy(b);$.each(c,function(c,d){a[b+d]={label:b,property:d,list:[]}})}),$(".title[property],.grouplist[property]",b).remove(),$.each(h,function(b,c){var d=c.data().data;if(d){var e=mining.mappingutils.getName(d),f=mining.mappingutils.getLabelName(d),g=mining.mappingutils.getTypeName(d);$.each(d,function(b,d){var h=a[e+b],i=d,j=!1;mining.utils.isEmpty(h)||("label"==b?i=f:"type"==b&&(i=g),$.each(h.list,function(a,b){return b.name==i?(b.ids.pushOnly("#"+c.data().id),b.count++,j=!0,!1):void 0}),j||h.list.push({ids:["#"+c.data().id],name:i,count:1}))})}}),$.each(g.getdata(":selected"),function(b,c){var d=c,e=mining.mappingutils.getName(d),f=mining.mappingutils.getLabelName(d),g=mining.mappingutils.getTypeName(d);$.each(d,function(b,c){var h=a[e+b],i=c,j=!1;mining.utils.isEmpty(h)||("label"==b?i=f:"type"==b&&(i=g),$.each(h.list,function(a,b){return b.name==i?(b.ids.pushOnly("#"+d.id),b.count++,j=!0,!1):void 0}),j||h.list.push({ids:["#"+d.id],name:i,count:1}))})}),$.each(a,function(a,c){var d=mining.mappingutils.getPropLabel(c.property),e=$('.grouplist[property="'+c.property+'"]',b);mining.utils.isEmpty(d)||c.list.length<1||(e.size()<1&&($(".propertylist",b).append(['<div class="title nopadding" property="'+c.property+'"><span class="text">'+d+"</span></div>",'<div class="grouplist" property="'+c.property+'" count="0"></div>'].join("")),e=$('.grouplist[property="'+c.property+'"]',b)),$.each(c.list,function(a,b){var c=$('[property="'+b.name+'"]',e);if(e.attr("count",parseInt(e.attr("count"))+b.count),c.size()>0){$(".count",c).text(parseInt($(".count",c).text())+b.count);var d=c.data("data");return $.each(b.ids,function(a,b){d.pushOnly(b)}),c.data("data",d),void 0}e.append(['<div class="groupitem" property="'+b.name+'">','<div class="name" title="'+b.name+'">'+b.name+"</div>",'<div class="count">'+b.count+"</div>",'<div class="percentbar" style="width:1px;"></div>',"</div>"].join("")).find(".groupitem:last").data("data",b.ids)}))}),$(".propertylist .groupitem",b).each(function(){var a=$(this),b=parseInt(a.parent().attr("count")),c=parseInt($(".count",a).text()),d=(150*(c/b)).toFixed(2),e=parseFloat((100*d/150).toFixed(2))+"%";bartitle=$(".name",a).attr("title")+"："+e,$(".percentbar",a).css("width",d+"px").parent().attr("title",bartitle),$.each(a.nextAll(),function(){var b=$(this);c<parseInt($(".count",b).text())&&b.insertBefore(a)})}),o()},o=function(){var c=a.height(),d=(c-40-128-100)/4,e=0,f=$(".infolistcontent",b).size();$(".infolistcontent",b).css("height","auto").each(function(){var a=$(this).height();d>a&&(e+=d-a,f--)});var g=d+e/f;$(".infolistcontent",b).each(function(){$(this).height()>g&&$(this).height(g)})};return{init:k}}});
