define("scopa/core/common/infoside/hartsdetails_bak",[],function(a,b,c){var d={merge:mining.baseurl.core+"/query/merge",expandHartsEdge:mining.baseurl.core+"/query/expandHartsEdge"};c.exports=function(){var a=function(a,c,e,f){var g=[];ruleList=mining.mappingutils.getHartEvents(a),$.ajax({url:d.merge,type:"POST",headers:{"Content-Type":"application/json"},contentType:"application/json",data:JSON.stringify({ids:[a.to_key,a.from_key],events:[],rules:ruleList,withObject:!1}),success:function(d){g=d.l||[],b(a,c,e,f,g)},error:function(a){mining.utils.alertMsg(a,"获取数据失败，请稍后重试！","error")}})},b=function(a,b,e,f,g){$.ajax({url:d.expandHartsEdge,data:{eid0:a.from_key,eid1:a.to_key,events:ruleList.join(",")},type:"get",success:function(d){edge_info=d.edge_info,c(a,b,e,f,g,edge_info)},error:function(){seajs.log("获取事件信息失败，请稍后重试！")}})},c=function(a,b,c,d,e,f){if($(" main",b).remove(),!mining.utils.isEmpty(f)){var g=function(a){var b="",c=['<div class="property hide">'];return $.each(mining.mappingutils.getProperties(a,"primary"),function(a,b){c.push('<span style="display: block" >'+b.name+"："+b.value+"</span>")}),c.push("</div>"),$.each(mining.mappingutils.getShowlabel(a,"bigger"),function(a,c){b+='<span style="display: block" class="txt" >'+c.value+"</span>"}),b+c.join("")};0==b.siblings(".eventtab").length&&b.before("<ul class='eventtab'><li class='active' ismerge='true'>命中事件</li><li ismerge='false' >全部事件</li></ul>"),$("table",b).after("<main role='main'><ol class='timelineinfo'></ol></main>");var h=function(a){a="true"==a?!0:!1;var h=[];$.each(f,function(f,i){var j=[];if($.each(i.events,function(a,b){var c=b[0].concat(b[1]);j=j.concat(c),j.sort(function(a,b){return parseInt(b.time)-parseInt(a.time)})}),$.each(e,function(a,b){$.each(j,function(a,c){mining.utils.isEmpty(c)&&j.remove(c);try{if(b.from==c.id)return c.harts=!0,h.push(c),$.each(j,function(a,d){return b.to==d.id?(h.push(d),c.toId=d.id,!0):void 0}),!0}catch(d){seajs.log(c)}})}),a&&(j=h),0==j.length)return $("main",b).html("没有数据"),void 0;$("main",b).html('<ol class="timelineinfo"></ol>');var k=moment(parseInt(j[0].time)).format("YYYY-MM-DD");$.each(j,function(a,e){if(!mining.utils.isEmpty(e)&&!mining.utils.isEmpty(e.key)){var f=moment(parseInt(e.time)).format("YYYY-MM-DD"),h=(moment(parseInt(e.time)).format("YYYY-MM-DD HH:mm:ss"),"");-1!=c.indexOf(e.key)?h="l":-1!=d.indexOf(e.key)&&(h="r"),mining.utils.isEmpty(h)||($(".timelineinfo:first",b).append([(k!=f?'<li class="dateinfo  timelineinfo-r" >'+k+"</li>":"")+'<li eventid="'+e.id+'" toid="'+e.toId+'" class="timelineinfo-'+(e.harts?"l harts":h)+'">',g(e,name),"<button></button>","</li>"+(a==j.length-1?'<li class="dateinfo  timelineinfo-r" >'+f+"</li>":"")].join("")),k=f)}}),$.each($(".harts",b),function(a,b){var c=$(b).offset().top,d=$(".timelineinfo li[eventid="+$(b).attr("toid")+"]").offset().top;$(b).css("top",d-c+"px")}),$.each($(".timelineinfo li",b),function(a,b){var c,d,e=$(b),f=e.offset().top,g=e.css("top").replace("px","");if(g=isNaN(g)?0:Number(g),d=e.prev(),d&&d.length>0)if(c=d.offset().top,e.attr("eventid")==d.attr("toid")||e.attr("toid")==d.attr("eventid"))e.css("top",c-f+g+"px");else{var h=c+d.outerHeight()+10-f;e.css("top",h+g+"px")}}),$(".timelineinfo",b).height($(".timelineinfo li:last").outerHeight()+$(".timelineinfo li:last").offset().top-200),$(".timelineinfo .property",b).mCustomScrollbar({theme:"minimal"})})};b.parent().off("click",".eventtab li").on("click",".eventtab li",function(){$(this).addClass("active").siblings().removeClass("active"),h($(this).attr("ismerge"))}),b.off("mouseover mouseout",".timelineinfo li").on("mouseover",".timelineinfo li",function(){$(this).css("z-index",111).find(".property").removeClass("hide")}).on("mouseout",".timelineinfo li",function(){$(this).css("z-index",100).find(".property").addClass("hide")}),$(" .eventtab li:first",b.parent()).click()}};return{init:a}}});
