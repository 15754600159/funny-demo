define("scopa/core/common/infoside/details",["core/common/customelement","./hartsdetails"],function(a,b,c){var d={graph:null,eventModule:null,container:null,selection:null,eventarr:null},e={merge:mining.baseurl.core+"/query/merge",expandEdge:mining.baseurl.core+"/query/expandEdge",expandHartsEdge:mining.baseurl.core+"/query/expandHartsEdge"},f=a("core/common/customelement");c.exports=function(){var b,c,g=null,h=null,i=null,j=null,k=function(a){a=$.extend({},d,a),g=a.graph,h=a.eventModule,b=a.container,c=$(".info-details",b),i=a.selection||[],j=a.eventarr||[],mining.utils.isEmpty(g)||b.size()<1||c.size()<1||($(".propertylist,.selectedlist",c).mCustomScrollbar({theme:"minimal"}),l(),r())},l=function(){c.off("click",".detailsitem").on("click",".detailsitem",function(){0!=$(this).index()&&(m($(this)),-1!=$.hash().indexOf("graph")?mining.utils.serverLog(51,$(this).find(".name").attr("title")):$(".page-map .breadnav-map").hasClass("active")&&mining.utils.serverLog(71,$(this).find(".name").attr("title")))})},m=function(a){var d=a.attr("gid");if(a.size()<1||a.hasClass("active")||mining.utils.isEmpty(d)){var e=$(".primaryinfo",c).attr("gid");if(mining.utils.isEmpty(e)||g.$("#"+e).length<1){if(g.elements().length<1)return q(),void 0;e=g.elements()[0].data("data")[0].gid}d=e}a.addClass("active").siblings().removeClass("active");var f;g.getOverlays?$.each(i,function(a,b){var c=b.data("data");return $.each(c,function(a,b){(b.id==d||b.gid==d)&&(f=b)}),f?!1:void 0}):f=$('.eventlistdlg .eventlist tr[gid="'+d+'"]').size()>0?h.getdata(d):i.filter("#"+d).data().data,"relation"==f.etype?p(f,a):o(f,a),mining.utils.checkImg($(".itemthumb img",c));var j=$(".primaryinfo",c).height();$(".propertylist",c).height(b.height()-(j>0?j:80)-115-$(".selectedlist",c).height())},n=function(a){mining.utils.isEmpty(a)||$.each(a,function(a,b){b.value&&"null"!=b.value&&$(".propertylist tbody [pro="+a+"]",c).size()<1&&$(".propertylist tbody",c).append('<tr><td class="ellipsis" title="'+b.value+'" pro="'+a+'"> <b>'+b.name+"</b>："+b.value+"</td></tr>")})},o=function(a){var b=mining.mappingutils.getProperties(a,"primary"),d=mining.mappingutils.getProperties(a,"minor"),e="";a=mining.mappingutils.formatProperty(a),$(".eventtab",c).remove(),$(".propertylist main",c).remove(),$(".propertylist tbody",c).html(""),$(".propertylist tbody",c).html("<tr><td ><b>类型&nbsp;/&nbsp;描述</b></td></tr>"),$.each(b,function(b,c){if("string"==typeof a[b]){var d="<b>"+c.name+"：</b>"+c.value;e+='<p class="ellipsis" title="'+d.replace("<b>","").replace("</b>","")+'">'+d+"</p>"}}),n(d);var g=mining.mappingutils.getGraphIcon(a);$(".primaryinfo",c).html(['<div class="infobox" key="'+a.key+'">','<div class="itemthumb '+a.etype+("person"==a.label&&"女"==a.PERSON_xb?" women":"")+'" style="background-image:url('+g+');">','<img class="txtm" src="'+(a.photoUrl?a.photoUrl:g)+'" _src="'+g+'">',"</div>",'<div class="iteminfo">'+e+"</div>","</div>"].join("")).removeClass("relationinfo").attr("gid",a.gid),"custom"==a.specificType&&a.owner==mining.userinfo.user_id&&$(".primaryinfo",c).off("click",".delcustomele").on("click",".delcustomele",function(){f.del({id:a.gid,type:"entity",success:function(){graphModule.delelements("#"+a.gid);try{scopaConfig.pages.cooperation.getPersonalInfomation()}catch(b){}}}),-1!=$.hash().indexOf("graph")?mining.utils.serverLog(52,"实体：gid="+a.gid):$(".page-map .breadnav-map").hasClass("active")&&mining.utils.serverLog(72,"实体：gid="+a.gid)}).append('<button class="btn-current delcustomele">删除</button'),$(".propertylist",c).mCustomScrollbar("scrollTo",0)},p=function(b,d){var h=b,i=mining.mappingutils.getShowlabel(h),j=g.filter("#"+b.from).data().data,k=g.filter("#"+b.to).data().data,l=d.data("edge_info")||[],m=mining.mappingutils.getGraphIcon(h),o=mining.mappingutils.getGraphIcon(j),p=mining.mappingutils.getGraphIcon(k);if($(".primaryinfo",c).html(['<div class="infobox" key="'+j.key+'">','<div class="itemthumb '+("person"==j.label&&"女"==j.PERSON_xb?" women":"")+'"  style="background-image:url('+o+');">','<img class="txtm" src="'+(j.photoUrl?j.photoUrl:o)+'" _src="'+o+'">',"</div>",'<div class="iteminfo"><b>'+mining.mappingutils.getTitle(j).replaceAll("-","\n")+"</b></div>","</div>",'<div class="infobox rinfo">',"harts"==h.label?'<div class="hartslabel">'+mining.mappingutils.getRuleLabel(h).join("</br>")+"</div>":'<div class="itemthumb"  style="background-image:url('+m+');"><img class="txtm" src="'+(h.photoUrl?h.photoUrl:m)+'" _src="'+m+'"></div><div class="iteminfo">'+(mining.utils.isEmpty(i)?"":i[0].value+(i[1]?"（"+i[1].value+"）":""))+"</div>",'<div class="itemline"><span class="pull-left"></span><span class="pull-right"></span></div>',"</div>",'<div class="infobox" key="'+k.key+'">','<div class="itemthumb '+("person"==k.label&&"女"==k.PERSON_xb?" women":"")+'"  style="background-image:url('+p+');">','<img class="txtm" src="'+(k.photoUrl?k.photoUrl:p)+'" _src="'+p+'">',"</div>",'<div class="iteminfo"><b>'+mining.mappingutils.getTitle(k).replaceAll("-","\n")+"</b></div>","</div>"].join("")).addClass("relationinfo").attr("gid",h.gid),"custom"==h.specificType&&h.owner==mining.userinfo.user_id&&$(".primaryinfo",c).off("click",".delcustomele").on("click",".delcustomele",function(){f.del({id:h.gid,type:"relation",success:function(){graphModule.delelements("#"+h.gid);try{scopaConfig.pages.cooperation.getPersonalInfomation()}catch(a){}}}),-1!=$.hash().indexOf("graph")?mining.utils.serverLog(52,"关系：gid="+h.gid):$(".page-map .breadnav-map").hasClass("active")&&mining.utils.serverLog(72,"关系：gid="+h.gid)}).append('<button class="btn-current delcustomele">删除</button>'),$(".propertylist main",c).remove(),$(".propertylist tbody",c).html(""),mining.utils.isEmpty(l))if("harts"==h.label){var q=new(a("./hartsdetails"));$(".propertylist table",c).after('<main role="main"><p class="txtc">数据加载中，请稍候...</p></main>'),setTimeout(function(){q.init(h,$(".propertylist",c),$(".infobox:first",c).attr("key"),$(".infobox:last",c).attr("key"))},100)}else{$(".eventtab",c).remove();var r=mining.mappingutils.getProperties(h,"primary");l=mining.mappingutils.getProperties(h,"minor"),$(".propertylist tbody",c).html("<tr><td><b>类型&nbsp;/&nbsp;描述</b></td></tr>"),n(r),$(".propertylist tbody",c).append("<tr><td>&nbsp;</td></tr>"),n(l),$ajax.ajax({url:e.expandEdge,data:{eid:h.gid,label:h.label},success:function(a){mining.utils.isEmpty(a)||mining.utils.isEmpty(a.edge_info)||$.each(a.edge_info,function(a,b){b.label=h.label,b.type=h.type;var c=mining.mappingutils.getProperties(b);n(c)})}})}},q=function(){$(".propertylist main",c).remove(),$(".primaryinfo,.propertylist tbody,.detailslist",c).html("").removeAttr("gid")},r=function(){$(".detailslist",c).empty();var a=[];if(g.getOverlays)$.each(i,function(b,c){var d=c.data("data");$.each(d,function(b,c){a.push(c)})});else{var b=i.filter("edge.relation:selected,node:selected");0==b.length?$.each(i.filter("edge.relation,node"),function(b,c){var d=c.data().data;a.push(d)}):$.each(i.filter("edge.relation:selected,node:selected"),function(b,c){var d=c.data().data;a.push(d)})}a=j.concat(a),$(".detailslist",c).append(['<div class="detailsitem" >','<div class="num"><b>编号</b></div>','<div class="name ellipsis" ><b>名称</b></div>',"</div>"].join(""));var d="";if(mining.utils.isEmpty(a))return q(),$(".detailslist",c).empty(),void 0;$.each(a,function(a,b){var c=b,e=mining.mappingutils.getTitle(c);!c.gid&&c.id&&(c.gid=c.id),d+=['<div class="detailsitem" gid="'+c.gid+'">','<div class="num">'+(a+1)+"</div>",'<div class="name ellipsis" title="'+e+'">'+e+"</div>","</div>"].join("")}),$(".detailslist",c).append(d);var e,f,h;if(1==j.length)h=j[0];else if(g.getOverlays){var k="";g.elements(":selected").length>0&&(k=":selected"),h=g.elements(k)[0].data("data")[0]}else h=1==g.nodes(":selected").length?g.nodes()[0].data().data:g.edges(":selected").length>0?g.edges(":selected")[0].data().data:g.nodes(":selected").data().data;h&&(f=h.id||h.gid||h.data.id||h.data.gid),window.infosideModuleParam&&(f=window.infosideModuleParam,setTimeout(function(){window.infosideModuleParam=null},1e3)),e=$('.detailsitem[gid="'+f+'"]',c),(mining.utils.isEmpty(e)||e.size()<1)&&(e=$(".detailsitem:first",c).next()),m(e)};return{init:k}}});
