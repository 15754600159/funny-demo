define("scopa/core/graph/graphSearch",[],function(a,b,c){c.exports=function(){var a,b,c={container:$(".search-panel"),readyCallback:null,selectCallback:null,resizeCallback:null,clickCallback:null,dblclickCallback:null,dataCallback:null},d=[],e="",f=!0,g=function(b){b=b||{};var d=$.extend(c,b);a="string"==typeof d.container?$(d.container):d.container},h=function(a){switch(a){case"searchBox":return['<div class="search-box">','<div class="search-range pull-left">','<span class="show-range" data-attr-type="primary">主要信息</span>','<i class="scopaicon scopaicon-xiala show-range-list"></i>','<ul class="range-list" style="display: none;">','<li><span data-attr-type="primary">主要信息</span><i class="scopaicon scopaicon-yixuan"></i></li>','<li><span data-attr-type="all">全部信息</span><i class="scopaicon"></i></li>',"</ul>","</div>",'<div class="search-info pull-left">','<input class="search-ipt" type="text" name="keywords" placeholder="输入关键字查询" />','<a class="searchbar-clear hidden" href="javascript:;" title="清空搜索内容"></a>','<i class="scopaicon scopaicon-sousuoxiao search-nodes"></i>',"</div>","</div>"].join("")}},i=function(){$.each(b,function(a,b){var c=b.data().data,d=mining.mappingutils.getProperties(c,"primary");k(c.gid,d)})},j=function(){$.each(b,function(a,b){var c=b.data().data,d=mining.mappingutils.getProperties(c);k(c.gid,d)})},k=function(a,b){$.each(b,function(b,c){return-1!=c.value.indexOf(e)?(d.push("#"+a),!1):void 0})},l=function(b){b&&(f="show"==b?!0:!1),f?(d=[],e="",a.removeClass("hidden").html(h("searchBox")),f=!1,m()):(a.empty().addClass("hidden"),e="",f=!0)},m=function(){var c="primary";a.off("click",".show-range-list").on("click",".show-range-list",function(){$(".range-list",a).toggle()}),a.off("click",".range-list li").on("click",".range-list li",function(){var b=$(this).find("span");$(".search-box .search-range .show-range",a).attr("data-attr-type",b.attr("data-attr-type")).text(b.text()),c=b.attr("data-attr-type"),$(this).siblings().find(".scopaicon").removeClass("scopaicon-yixuan"),$(this).find(".scopaicon").addClass("scopaicon-yixuan"),$(".show-range-list",a).click(),$(".search-nodes",a).click()}),a.off("click",".search-nodes").on("click",".search-nodes",function(){if(b=dragon.nodes(".entity"),0!=b.length&&!mining.utils.isEmpty(e)){"all"==c?j():i(),l();var a=dragon.$(d.join(","));dragon.elements(":selected").unselect(),a.select(),dragon.animate({fit:{eles:a,padding:20}},{duration:1e3})}}),$(document).off("click.close-searchBox").on("click.close-searchBox",function(a){f||$(a.target).hasClass("graph-search")||$(a.target).parents().hasClass("graph-search")||$(a.target).hasClass("search-panel")||$(a.target).parents().hasClass("search-panel")||!mining.utils.isEmpty(e)||l()}),a.on("keyup",".search-ipt",function(b){13==b.keyCode?$(".search-nodes",a).click():e=$(this).val().trim()}).on("blur",".search-ipt",function(){$(".searchbar-clear").removeClass("hidden")}).on("change",".search-ipt",function(){e=$(this).val().trim()}),a.off("click",".searchbar-clear").on("click",".searchbar-clear",function(){$(".search-ipt",a).val(""),e="",$(this).addClass("hidden")})};return{init:g,controlPanel:l}}});
